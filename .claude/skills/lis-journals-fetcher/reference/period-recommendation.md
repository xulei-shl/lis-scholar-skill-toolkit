# æ™ºèƒ½å¹´æœŸæ¨èç­–ç•¥

## ç›®æ ‡

å½“ç”¨æˆ·æœªæŒ‡å®šå¹´æœŸå‚æ•°æ—¶ï¼Œæ ¹æ®å‘è¡Œå‘¨æœŸã€ä¸Šæ¬¡è·å–è®°å½•ã€å½“å‰æ—¥æœŸæ™ºèƒ½æ¨èç›®æ ‡å¹´æœŸã€‚

## æ¨èç­–ç•¥

### ç­–ç•¥ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | åœºæ™¯ | æ¨èé€»è¾‘ |
|--------|------|----------|
| 1 | å¹´åˆï¼ˆ1-2æœˆï¼‰ | æä¾›å¤šé€‰é¡¹ï¼šä¿å®ˆæœŸï¼ˆå€’æ•°ç¬¬äºŒæœŸï¼‰ã€ä¸Šå¹´æœ€åä¸€æœŸã€æ‰‹åŠ¨è¾“å…¥ |
| 2 | æœˆåˆï¼ˆ1-7å·ï¼‰ | æ¨èä¸Šä¸€æœŸï¼ˆæ›´å¯èƒ½å·²å‘å¸ƒï¼‰ |
| 3 | æœ‰ä¸Šæ¬¡è®°å½• | å¢é‡æ¨èï¼ˆä»ä¸Šæ¬¡+1 åˆ°æ¨èæœŸï¼‰ |
| 4 | é¦–æ¬¡çˆ¬å– | æ¨èä¸Šä¸€æœŸï¼ˆä¿å®ˆç­–ç•¥ï¼‰ |

### ç®—æ³•å®ç°ï¼ˆä¼ªä»£ç ï¼‰

```python
def smart_period_recommend(frequency: str, last_fetch: str, current_date) -> str:
    """
    æ™ºèƒ½æ¨èå¹´æœŸ

    å‚æ•°:
        frequency: å‘è¡Œå‘¨æœŸï¼ˆ"æœˆåˆŠ"/"åŒæœˆåˆŠ"/"å­£åˆŠ"/"åŠæœˆåˆŠ"ï¼‰
        last_fetch: ä¸Šæ¬¡è·å–å¹´æœŸï¼ˆæ ¼å¼ï¼š"YYYY-I"ï¼‰, å¯ä¸º None
        current_date: å½“å‰æ—¥æœŸï¼ˆdatetime å¯¹è±¡ï¼‰

    è¿”å›:
        æ¨èå¹´æœŸå­—ç¬¦ä¸²ï¼ˆå•æœŸï¼š"2025-6"ï¼Œå¤šæœŸï¼š"2025-3, 2025-4, 2025-5"ï¼‰
    """
    year, month, day = current_date.year, current_date.month, current_date.day

    # è®¡ç®—å½“å‰æœŸå·
    if frequency == "æœˆåˆŠ":
        current_issue = month
    elif frequency == "åŒæœˆåˆŠ":
        current_issue = (month + 1) // 2
    elif frequency == "å­£åˆŠ":
        current_issue = (month + 2) // 3
    elif frequency == "åŠæœˆåˆŠ":
        current_issue = (month - 1) * 2 + (2 if day > 15 else 1)

    # ç­–ç•¥1: å¹´åˆæ¨èä¸Šå¹´æœ€åä¸€æœŸ
    if month <= 2:
        if frequency == "æœˆåˆŠ":
            return f"{year-1}-12"
        elif frequency == "åŒæœˆåˆŠ":
            return f"{year-1}-6"
        elif frequency == "å­£åˆŠ":
            return f"{year-1}-4"
        elif frequency == "åŠæœˆåˆŠ":
            return f"{year-1}-24"

    # ç­–ç•¥2: æœˆåˆæ¨èä¸Šä¸€æœŸ
    if day <= 7 and current_issue > 1:
        return f"{year}-{current_issue - 1}"

    # ç­–ç•¥3: æœ‰ä¸Šæ¬¡è®°å½•ï¼Œå¢é‡æ¨è
    if last_fetch:
        last_year, last_issue = parse_period(last_fetch)
        if last_year == year and last_issue < current_issue:
            # è¿”å›å¤šæœŸåˆ—è¡¨: [ä¸Šæ¬¡+1, ..., å½“å‰æœŸ-1]
            issues = list(range(last_issue + 1, current_issue))
            return ", ".join([f"{year}-{i}" for i in issues])

    # ç­–ç•¥4: é¦–æ¬¡çˆ¬å–ï¼Œæ¨èä¸Šä¸€æœŸï¼ˆæ›´å¯èƒ½å·²å‘å¸ƒï¼‰
    if current_issue > 1:
        return f"{year}-{current_issue - 1}"

    return f"{year}-{current_issue}"


def parse_period(period_str: str) -> tuple:
    """
    è§£æå¹´æœŸå­—ç¬¦ä¸²

    å‚æ•°:
        period_str: å¹´æœŸå­—ç¬¦ä¸²ï¼ˆå¦‚ "2025-6"ï¼‰

    è¿”å›:
        (å¹´ä»½, æœŸå·) å…ƒç»„
    """
    year, issue = period_str.split("-")
    return int(year), int(issue)
```

## æ¨èå±•ç¤ºæ ¼å¼

### å¹´åˆå¤šé€‰é¡¹æ¨èï¼ˆ1-2æœˆï¼‰

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ å¹´æœŸé€‰æ‹©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æœŸåˆŠ: æ¡£æ¡ˆå­¦ (åŒæœˆåˆŠ)
å½“å‰æ—¥æœŸ: 2026-02-12
ä¸Šæ¬¡è·å–: æ— 

æ¨èé€‰é¡¹:
  [1] 2025-05 (ä¿å®ˆ) â­ - 9-10æœˆæœŸï¼Œç¡®å®šå·²å‘å¸ƒ
  [2] 2025-06 (ä¸Šå¹´æœ€åä¸€æœŸ) - 11-12æœˆæœŸï¼Œå¯èƒ½åˆšå‡º
  [3] æ‰‹åŠ¨è¾“å…¥å¹´æœŸ
```

### å¤šæœŸå¢é‡æ¨è

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ æ™ºèƒ½å¹´æœŸæ¨è
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æœŸåˆŠ: å›¾ä¹¦æƒ…æŠ¥çŸ¥è¯† (åŒæœˆåˆŠ)
å½“å‰æ—¥æœŸ: 2026-06-15
ä¸Šæ¬¡è·å–: 2026-1

æ¨èå¹´æœŸ: 2026-2, 2026-3 â­
ç†ç”±: å¢é‡æ›´æ–°ï¼ˆä¸Šæ¬¡è·å–åæ–°å¢ 2 æœŸï¼‰

å¤‡é€‰å¹´æœŸ:
  â€¢ 2026-3 (ä»…æœ€æ–°ä¸€æœŸ)
  â€¢ æ‰‹åŠ¨è¾“å…¥å¹´æœŸ

è¯·é€‰æ‹© [1-3]:
  [1] ä½¿ç”¨æ¨èæ–¹æ¡ˆ (2026-2, 2026-3)
  [2] ä»…çˆ¬å–æœ€æ–°æœŸ (2026-3)
  [3] æ‰‹åŠ¨è¾“å…¥å¹´æœŸ
```

## ç”¨æˆ·äº¤äº’

ä½¿ç”¨ `AskUserQuestion` å·¥å…·è®©ç”¨æˆ·é€‰æ‹©æ¨èæ–¹æ¡ˆã€‚

### å¹´åˆå¤šé€‰é¡¹äº¤äº’ï¼ˆ1-2æœˆï¼‰

```python
AskUserQuestion(
    questions=[
        {
            "question": "è¯·é€‰æ‹©å¹´æœŸï¼ˆå½“å‰2æœˆï¼ŒåŒæœˆåˆŠï¼‰",
            "header": "å¹´æœŸé€‰æ‹©",
            "options": [
                {"label": "2025-05 (ä¿å®ˆ)", "description": "9-10æœˆæœŸï¼Œç¡®å®šå·²å‘å¸ƒ"},
                {"label": "2025-06 (ä¸Šå¹´æœ€å)", "description": "11-12æœˆæœŸï¼Œå¯èƒ½åˆšå‡º"},
                {"label": "æ‰‹åŠ¨è¾“å…¥", "description": "è¾“å…¥è‡ªå®šä¹‰å¹´æœŸ"}
            ],
            "multiSelect": False
        }
    ]
)
```

### å¸¸è§„å•æœŸæ¨èäº¤äº’

```python
AskUserQuestion(
    questions=[
        {
            "question": "è¯·é€‰æ‹©å¹´æœŸæ–¹æ¡ˆ",
            "header": "å¹´æœŸé€‰æ‹©",
            "options": [
                {"label": "ä½¿ç”¨æ¨èå¹´æœŸ", "description": "2025-6: ä¸Šå¹´æœ€åä¸€æœŸï¼Œå·²å‘å¸ƒ"},
                {"label": "å°è¯•å½“å‰å¹´æœŸ", "description": "2026-1: å½“å‰æœŸï¼Œå¯èƒ½æœªå‘å¸ƒ"},
                {"label": "æ‰‹åŠ¨è¾“å…¥", "description": "è¾“å…¥è‡ªå®šä¹‰å¹´æœŸ"}
            ],
            "multiSelect": False
        }
    ]
)
```

## å„å‘¨æœŸå¹´æœŸè®¡ç®—è§„åˆ™

| æœˆä»½ | æœˆåˆŠ | åŒæœˆåˆŠ | å­£åˆŠ | åŠæœˆåˆŠ (1-15æ—¥) | åŠæœˆåˆŠ (16-31æ—¥) |
|------|------|--------|------|-----------------|------------------|
| 1æœˆ | 1 | 1 | 1 | 1 | 2 |
| 2æœˆ | 2 | 1 | 1 | 3 | 4 |
| 3æœˆ | 3 | 2 | 1 | 5 | 6 |
| 4æœˆ | 4 | 2 | 2 | 7 | 8 |
| 5æœˆ | 5 | 3 | 2 | 9 | 10 |
| 6æœˆ | 6 | 3 | 2 | 11 | 12 |
| 7æœˆ | 7 | 4 | 3 | 13 | 14 |
| 8æœˆ | 8 | 4 | 3 | 15 | 16 |
| 9æœˆ | 9 | 5 | 3 | 17 | 18 |
| 10æœˆ | 10 | 5 | 4 | 19 | 20 |
| 11æœˆ | 11 | 6 | 4 | 21 | 22 |
| 12æœˆ | 12 | 6 | 4 | 23 | 24 |

## åŠæœˆåˆŠæœŸå·å¯¹ç…§è¡¨

| æœˆä»½ | æ—¥æœŸèŒƒå›´ | æœŸå· | æœˆä»½ | æ—¥æœŸèŒƒå›´ | æœŸå· |
|------|---------|------|------|---------|------|
| 1æœˆ | 1-15æ—¥ | 1 | 7æœˆ | 1-15æ—¥ | 13 |
| 1æœˆ | 16-31æ—¥ | 2 | 7æœˆ | 16-31æ—¥ | 14 |
| 2æœˆ | 1-15æ—¥ | 3 | 8æœˆ | 1-15æ—¥ | 15 |
| 2æœˆ | 16-29æ—¥ | 4 | 8æœˆ | 16-31æ—¥ | 16 |
| 3æœˆ | 1-15æ—¥ | 5 | 9æœˆ | 1-15æ—¥ | 17 |
| 3æœˆ | 16-31æ—¥ | 6 | 9æœˆ | 16-30æ—¥ | 18 |
| 4æœˆ | 1-15æ—¥ | 7 | 10æœˆ | 1-15æ—¥ | 19 |
| 4æœˆ | 16-30æ—¥ | 8 | 10æœˆ | 16-31æ—¥ | 20 |
| 5æœˆ | 1-15æ—¥ | 9 | 11æœˆ | 1-15æ—¥ | 21 |
| 5æœˆ | 16-31æ—¥ | 10 | 11æœˆ | 16-30æ—¥ | 22 |
| 6æœˆ | 1-15æ—¥ | 11 | 12æœˆ | 1-15æ—¥ | 23 |
| 6æœˆ | 16-30æ—¥ | 12 | 12æœˆ | 16-31æ—¥ | 24 |

**è®¡ç®—å…¬å¼**ï¼š`issue = (month - 1) * 2 + (2 if day > 15 else 1)`

## å¹´åˆæ¨èå¯¹ç…§è¡¨ï¼ˆ1-2æœˆï¼‰

| å‘¨æœŸ | ä¿å®ˆé€‰é¡¹ | ä¸Šå¹´æœ€åæœŸ | è¯´æ˜ |
|------|-------------------|-------------------|------|
| æœˆåˆŠ | ä¸Šå¹´11æœŸ | ä¸Šå¹´12æœŸ | ä¿å®ˆæœŸæ›´ç¡®å®šå·²å‘å¸ƒ |
| åŒæœˆåˆŠ | ä¸Šå¹´5æœŸ | ä¸Šå¹´6æœŸ | ä¿å®ˆæœŸæ›´ç¡®å®šå·²å‘å¸ƒ |
| å­£åˆŠ | ä¸Šå¹´3æœŸ | ä¸Šå¹´4æœŸ | ä¿å®ˆæœŸæ›´ç¡®å®šå·²å‘å¸ƒ |
| åŠæœˆåˆŠ | ä¸Šå¹´23æœŸ | ä¸Šå¹´24æœŸ | ä¿å®ˆæœŸæ›´ç¡®å®šå·²å‘å¸ƒ |

> **æ¨èç­–ç•¥**ï¼šå¹´åˆï¼ˆ1-2æœˆï¼‰æ—¶æä¾›ä¸¤ä¸ªé€‰é¡¹è®©ç”¨æˆ·é€‰æ‹©ï¼Œä¼˜å…ˆæ¨èä¿å®ˆé€‰é¡¹ã€‚
